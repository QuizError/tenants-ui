<div class="container mt-5">
  <div class="card shadow-sm rounded-4 p-4">
    <h5 class="fw-bold mb-4">
      <i class="fas fa-user-plus me-2 text-primary"></i>
      Add New Membership
    </h5>

    <!-- Loading State -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading data, please wait...</p>
      <div class="mt-2 text-muted small">
        <div *ngIf="userDataList.length === 0">Loading users...</div>
        <div *ngIf="groupDataList.length === 0">Loading groups...</div>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="alert alert-danger">
      <i class="fas fa-exclamation-circle me-2"></i>
      {{ error }}
      <button type="button" class="btn-close float-end" (click)="error = null"></button>
    </div>

    <!-- Form -->
    <form *ngIf="!loading" (ngSubmit)="onSubmit()" [formGroup]="addMemebrshipForm">
      <div class="row g-3">
        <!-- User Selection -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">Member Name <span class="text-danger">*</span></label>
          <select 
            class="form-select rounded-pill shadow-sm"
            formControlName="userUid"
            [class.is-invalid]="addMemebrshipForm.get('userUid')?.invalid && addMemebrshipForm.get('userUid')?.touched"
            required>
            <option value="" disabled selected>-- Select User --</option>
            <option *ngFor="let user of userDataList" [value]="user.uid">
              {{ user.firstname }} {{ user.lastname }}
              <span *ngIf="user.email">({{ user.email }})</span>
            </option>
          </select>
          <div *ngIf="addMemebrshipForm.get('userUid')?.invalid && addMemebrshipForm.get('userUid')?.touched" 
               class="invalid-feedback">
            Please select a user
          </div>
        </div>

        <!-- Group Selection -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">Group <span class="text-danger">*</span></label>
          <select 
            class="form-select rounded-pill shadow-sm"
            formControlName="groupUid"
            [class.is-invalid]="addMemebrshipForm.get('groupUid')?.invalid && addMemebrshipForm.get('groupUid')?.touched"
            required>
            <option value="" disabled selected>-- Select Group --</option>
            <option *ngFor="let group of groupDataList" [value]="group.uid">
              {{ group.name }}
              <span *ngIf="group.ownershipType">({{ group.ownershipType }})</span>
            </option>
          </select>
          <div *ngIf="addMemebrshipForm.get('groupUid')?.invalid && addMemebrshipForm.get('groupUid')?.touched" 
               class="invalid-feedback">
            Please select a group
          </div>
        </div>

        <!-- Status -->
        <div class="col-md-6">
          <label class="form-label fw-semibold">Status <span class="text-danger">*</span></label>
          <select 
            class="form-select rounded-pill shadow-sm"
            formControlName="memberStatus"
            [class.is-invalid]="addMemebrshipForm.get('memberStatus')?.invalid && addMemebrshipForm.get('memberStatus')?.touched"
            required>
            <option value="ACTIVE">Active</option>
            <option value="INACTIVE">Inactive</option>
          </select>
          <div *ngIf="addMemebrshipForm.get('memberStatus')?.invalid && addMemebrshipForm.get('memberStatus')?.touched" 
               class="invalid-feedback">
            Please select a status
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="d-flex justify-content-end gap-2 mt-4">
        <button 
          type="button" 
          class="btn btn-outline-secondary rounded-pill px-4" 
          (click)="onCancel()"
          [disabled]="loading">
          <i class="fas fa-times me-2"></i> Cancel
        </button>
        <button 
          type="submit" 
          class="btn btn-primary rounded-pill px-4"
          [disabled]="addMemebrshipForm.invalid || loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          <i *ngIf="!loading" class="fas fa-save me-2"></i>
          {{ loading ? 'Saving...' : 'Save Membership' }}
        </button>
      </div>
    </form>
  </div>
</div>