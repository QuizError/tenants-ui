<div class="container mt-4">
  <!-- Loader -->
  <ng-container *ngIf="loading">
    <div class="d-flex justify-content-center align-items-center" style="height: 300px;">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
  </ng-container>

  <!-- Error -->
  <ng-container *ngIf="!loading && error">
    <mat-card class="error-card">
      <mat-card-header>
        <mat-card-title>Error</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>{{ error }}</p>
        <button mat-raised-button color="primary" (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
          Back to Payments
        </button>
      </mat-card-content>
    </mat-card>
  </ng-container>

  <!-- Success -->
  <ng-container *ngIf="!loading && !error && payment">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>Payment Receipt</h2>
      <div class="d-flex gap-2">
        <button mat-raised-button color="primary" (click)="printReceipt()">
          <mat-icon>print</mat-icon> Print
        </button>
        <button mat-stroked-button (click)="goBack()">
          <mat-icon>arrow_back</mat-icon> Back to List
        </button>
      </div>
    </div>

    <!-- Payment Details -->
    <mat-card class="mb-4">
      <mat-card-header class="bg-light p-3">
        <mat-card-title>Payment Details</mat-card-title>
      </mat-card-header>
      <mat-card-content class="p-4">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Payment Reference:</strong> {{ payment?.uid || 'N/A' }}</p>
            <p><strong>Date:</strong> {{ formatDate(payment.paymentDate) }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Amount Paid:</strong> {{ payment?.paidAmount | currency:payment?.currency }}</p>
            <p><strong>Payment Method:</strong> {{ payment?.paymentChannel || 'N/A' }}</p>
            <p *ngIf="payment?.fspName"><strong>Provider:</strong> {{ payment?.fspName }} ({{ payment?.fspCode }})</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Bill Details -->
    <mat-card *ngIf="bill" class="mb-4">
      <mat-card-header class="bg-light p-3">
        <mat-card-title>Bill Information</mat-card-title>
      </mat-card-header>
      <mat-card-content class="p-4">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Bill #:</strong> {{ bill?.billReferenceNumber || 'N/A' }}</p>
            <p><strong>Description:</strong> {{ bill?.billDescription || 'N/A' }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Total Amount:</strong> {{ bill?.totalAMount | currency:bill?.currency }}</p>
            <p><strong>Amount Due:</strong> {{ bill?.amountDue | currency:bill?.currency }}</p>
            <p><strong>Status:</strong>
              <span class="badge" [ngClass]="{
                'bg-success': bill?.billStatus === 'Paid',
                'bg-warning': bill?.billStatus === 'PartyPaid',
                'bg-danger': bill?.billStatus === 'Failed'
              }">
                {{ bill?.billStatus || 'N/A' }}
              </span>
            </p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </ng-container>
</div>

<!-- Print Styles -->
<style media="print">
  @page { size: auto; margin: 0mm; }
  body { margin: 1.6cm; }
  .no-print { display: none !important; }
  .print-only { display: block !important; }
  mat-card { box-shadow: none !important; border: 1px solid #ddd !important; }
</style>
